<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOVIE NIGHT</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css">

    <script src="https://unpkg.com/htmx.org@2.0.2"
        integrity="sha384-Y7hw+L/jvKeWIRRkqWYfPcvVxHzVzn5REgzbawhxAuQGwX1XWe70vji+VSeHOThJ"
        crossorigin="anonymous"></script>
</head>

<body>
    <header>
        <div class="header-container">
            <div class="LOGO">
                <a class="header_movie" href="/main/">Movie Night</a>
            </div>
        </div>
    </header>


    <ul class="search-bar">

        <div class="topnav">
            <form method="get" action="/search/">
                <input type="text" name="search" placeholder="Search..">
                <button type="submit">Search</button>
            </form>
        </div>


        </div>
    </ul>


    <ul class="grid">

        {{if .Movies}}
        {{range .Movies}}
        <div class="grid_background">

            <li class="grid-item">
                <form method="Post" action="/about/">
                    <input type="hidden" name="movie_ids" value="{{.Id}}">
                    <button type="submit" class="hiddenbutton">
                        <span class="Genre">{{.Genre}}</span>
                        <img type="submit" src="{{.PosterPath}}" alt="{{.Title}}">
                    </button>
                </form>

                <span class="grid-title">{{.Title}}</span>
            </li>
            <li class="gird-buttons">

                <div class="switch-movie-button">
                    <button class="switch-movie-button" href="#modal">
                        <a class=" open-modal">Switch</a>
                    </button>
                </div>
                <div class="switch-movie-button">
                    <form method="Post" action="/winner/">
                        <input type="hidden" name="winner_id" value="{{.Id}}">
                        <button type="submit" href="#main">Winner</button>
                    </form>
                </div>
            </li>

        </div>
        {{end}}
        {{if .WinnerMovie}}
        <div class="grid_background">
            <li class="grid-item">
                <form method="post" action="/about/">
                    <input type="hidden" name="movie_ids" value="{{.WinnerMovie.Id}}">
                    <button type="submit" class="hiddenbutton">
                        <span class="Genre">{{.WinnerMovie.Genre}}</span>
                        <img src="{{.WinnerMovie.PosterPath}}" alt="/static/images/No.Picture-Found.png">
                    </button>
                </form>
                <span class="grid-title">{{.WinnerMovie.Title}}</span>
            </li>
        </div>
        {{end}}
        {{else if .SearchMovies}}
        {{range .SearchMovies}}
        <div class=" grid_background">
            <li class="grid-item">
                <form method="Post" action="/about/">
                    <input type="hidden" name="movie_ids" value="{{.Id}}">
                    <button type="submit" class="hiddenbutton">
                        <img src="{{.PosterPath}}" alt="/static/images/No-Picture-Found.png">
                    </button>
                </form>
                <span class="title">{{.Title}}</span>
            </li>
            <div class="switch-movie-button">
                <form method="Post" action="/add-movie/">
                    <input type="hidden" name="mov_id" value="{{.Id}}">

                    <button class="switch-movie-button" href="#add">
                        <a class=" open-add">Switch</a>
                    </button>
                </form>

            </div>
        </div>
        {{end}}
        {{else}}
        <p>No movies found.</p>
        {{end}}
    </ul>

    <!-- The Modal for Switching Movies -->
    <div id="modal" class="modal">
        <div class="modal-content">

            <!-- Close the modal with a link -->
            <a href="#" class="close">&times;</a>
            <!-- Modal Search Form -->
            <form method="get" action="/search/">
                <input type="text" name="search" placeholder="Search..">
                <button type="submit">Search</button>

            </form>


        </div>
    </div>




    <!-- The Modal for Adding Movies -->
    <div id="add" class="modal">
        <div class="modal-content">
            <!-- Close the modal with a link -->
            <a href="#" class="close">&times;</a>

            <!--  <form action="/add-movie/" method="Post"> -->
            <!-- Hidden input for movie_id -->
            <!--  <input type="hidden" name="mov_id" id="movieIdVar"> -->

            <!-- Button for Anime -->
            <button type="submit" name="category" value="Anime">Anime</button>

            <!-- Button for Animation -->
            <button type="submit" name="category" value="Animation">Animation</button>

            <!-- Button for Action -->
            <button type="submit" name="category" value="Action">Action</button>

            <!-- Button for Drama -->
            <button type="submit" name="category" value="Drama">Drama</button>

            <!-- Button for Comedy -->
            <button type="submit" name="category" value="Comedy">Comedy</button>

            <!-- Button for Random -->
            <button type="submit" name="category" value="Random">Random</button>

            <!-- Button for Weird -->
            <button type="submit" name="category" value="Weird">Weird</button>
            <!--     </form> -->

            <script>

                // Get the movie ID from the element
                var movieId = document.getElementById('movieIdVar').getAttribute('value');
                // Set the value of the hidden input field to the movie ID
                document.getElementById('mov_id').value = movieId;

            </script>
        </div>
    </div>





    <script>
        // Get the modals
        var modal = document.getElementById("modal");
        var addModal = document.getElementById("add");

        // Get the buttons that open the modals
        var btnOpenModal = document.querySelectorAll(".open-modal");
        var btnOpenAdd = document.querySelectorAll(".open-add");


        // Get the <span> element that closes the modals
        var spanCloseModal = modal.querySelector(".close");
        var spanCloseAdd = addModal.querySelector(".close");

        document.querySelectorAll('.open-add').forEach(function (btn) {
            btn.addEventListener('click', function (e) {
                e.preventDefault();  // Prevent the default anchor behavior
            });
        });

        // Set up the event listeners for opening modals
        btnOpenModal.forEach(function (btn) {
            btn.addEventListener('click', function (e) {
                e.preventDefault();  // Prevent the default anchor behavior
                modal.style.display = "block";
            });
        });

        btnOpenAdd.forEach(function (btn) {
            btn.addEventListener('click', function (e) {
                e.preventDefault();  // Prevent the default anchor behavior
                addModal.style.display = "block";
            });
        });

        // When the user clicks on <span> (x), close the modals
        spanCloseModal.onclick = function () {
            modal.style.display = "none";
        }

        spanCloseAdd.onclick = function () {
            addModal.style.display = "none";
        }


        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function (event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
            if (event.target == addModal) {
                addModal.style.display = "none";
            }

        }


        document.querySelectorAll('.poster').forEach(function (poster) {
            poster.addEventListener('click', function (event) {
                event.preventDefault(); // Prevent the default behavior of the link
                const movieId = poster.getAttribute('data-movie-id');
                // window.location.href = `/info/?movie_id=${movieId}`; // Redirect with movie_id as a query parameter

            });
        });

    </script>

</html>